#!/usr/bin/env bash

weekday="$(date '+%a')"

month="$(date '+%b')"

day0="$(date '+%e')"

day00="$(date '+%d')"

year="$(date '+%Y')"

regex="^*{1,7}\s$weekday\s$month\s$day0\s.*$year$"

category="wizehive"

if [ -n "$1" ]; then
	category="$1"
fi

dir="$HOME/Notes/$category"

log="# Log for $weekday, $month $day0, $year

$(rg --heading -N -g '!*_log*' -A 20 -e "$regex" "$dir")
"
timestamp="$(rightnow)"
fileglob="$(date '+%Y%m%d')*$weekday*$month*$day00*_log*"
logfile="$(ls -1 $dir/$fileglob 2>/dev/null)"
filename="$timestamp--$weekday-$month-$day00-log__log_ignore.org"

if [ -n "$logfile" ]; then
	echo "$log" > $logfile
	cat $logfile
else
	echo "Creating log for today..."
	echo "$log" > $dir/$filename
	cat $dir/$filename
fi

